id: metadata
name: cdp-meta
version: 1.1.0
prefixes:
  linkml: https://w3id.org/linkml/
  cdp-meta: metadata
  ORCID: https://orcid.org/
  ROR: https://ror.org/
  UBERON: http://purl.obolibrary.org/obo/UBERON_
  CL: http://purl.obolibrary.org/obo/CL_
  GO: http://purl.obolibrary.org/obo/GO_
  #cdp-common: common
imports:
  - linkml:types
default_range: string
default_prefix: cdp-meta

classes:
  # ============================================================================
  # Snapshot / Thumbnail
  # ============================================================================

  PicturePath:
    description: A set of paths to representative images of a piece of data.
    attributes:
      snapshot:
        exact_mappings:
          - cdp-common:snapshot
      thumbnail:
        exact_mappings:
          - cdp-common:thumbnail

  # ============================================================================

  # ============================================================================
  # Author / Annotator
  # ============================================================================
  Author:
    description: >-
      Author of a scientific data entity.
    attributes:
      name:
        exact_mappings:
          - cdp-common:author_name
      email:
        exact_mappings:
          - cdp-common:author_email
      affiliation_name:
        exact_mappings:
          - cdp-common:author_affiliation_name
      affiliation_address:
        exact_mappings:
          - cdp-common:author_affiliation_address
      affiliation_identifier:
        exact_mappings:
          - cdp-common:affiliation_identifier
      corresponding_author_status:
        exact_mappings:
          - cdp-common:author_corresponding_author_status
      primary_author_status:
        exact_mappings:
          - cdp-common:author_primary_author_status
      ORCID:
        exact_mappings:
          - cdp-common:orcid
  # ============================================================================



  # ============================================================================
  # Funding source information
  # ============================================================================
  Funding:
    description: A funding source for a scientific data entity (base for JSON and DB representation).
    attributes:
      funding_agency_name:
        exact_mappings:
          - cdp-common:funding_agency_name
      grant_id:
        exact_mappings:
          - cdp-common:funding_grant_id
  # ============================================================================

  # ============================================================================
  # Deposition, release and last modified dates
  # ============================================================================
  DateStamp:
    description: A set of dates at which a data item was deposited, published and last modified.
    attributes:
      deposition_date:
        exact_mappings:
          - cdp-common:deposition_date
      release_date:
        exact_mappings:
          - cdp-common:release_date
      last_modified_date:
        exact_mappings:
          - cdp-common:last_modified_date

  # ============================================================================
  # Meta-Mixins
  # ============================================================================
  DatestampedEntity:
    abstract: true
    description: An entity with associated deposition, release and last modified dates.
    attributes:
      dates:
        range: DateStamp
        required: true

  AuthoredEntity:
    abstract: true
    description: An entity with associated authors.
    attributes:
      authors:
        range: Author
        required: true
        description: An ordered list of authors of the entity.
        multivalued: true
        inlined_as_list: true
        list_elements_ordered: true

  FundedEntity:
    abstract: true
    description: An entity with associated funding sources.
    attributes:
      funding:
        range: Funding
        recommended: true
        description: An ordered list of funding sources for the entity.
        multivalued: true
        inlined_as_list: true
        list_elements_ordered: true

  CrossReferencedEntity:
    abstract: true
    description: An entity with associated cross-references to other databases and publications.
    attributes:
      cross_references:
        range: CrossReferences

  PicturedEntity:
    abstract: true
    description: An entity with associated preview images.
    attributes:
      key_photos:
        range: PicturePath
        description: A set of paths to representative images of the entity.
        required: true
  # ============================================================================

  # ============================================================================
  # Experimental metadata
  # ============================================================================
  Organism:
    description: &desc_Organism The species from which the sample was derived.
    attributes:
      name:
        exact_mappings:
          -  cdp-common:organism_name
      taxonomy_id:
        exact_mappings:
          - cdp-common:organism_taxid

  Tissue:
    description: &desc_Tissue The type of tissue from which the sample was derived.
    attributes:
      name:
        exact_mappings:
          - cdp-common:tissue_name
      id:
        exact_mappings:
          - cdp-common:tissue_id

  CellType:
    description: &desc_CellType The cell type from which the sample was derived.
    attributes:
      name:
        exact_mappings:
          - cdp-common:cell_name
      id:
        exact_mappings:
          - cdp-common:cell_type_id

  CellStrain:
    description: &desc_CellStrain The strain or cell line from which the sample was derived.
    attributes:
      name:
        exact_mappings:
          - cdp-common:cell_strain_name
      id:
        exact_mappings:
          - cdp-common:cell_strain_id

  CellComponent:
    description: &desc_CellComponent The cellular component from which the sample was derived.
    attributes:
      name:
        exact_mappings:
          - cdp-common:cell_component_name
      id:
        exact_mappings:
          - cdp-common:cell_component_id

  ExperimentalMetadata:
    abstract: true
    description: Metadata describing sample and sample preparation methods used in a cryoET dataset.
    attributes:
      sample_type:
        exact_mappings:
          - cdp-common:preparation_sample_type
      sample_preparation:
        exact_mappings:
          - cdp-common:sample_preparation
      grid_preparation:
        exact_mappings:
          - cdp-common:grid_preparation
      other_setup:
        exact_mappings:
          - cdp-common:preparation_other_setup
      organism:
        description: *desc_Organism
        range: Organism
      tissue:
        description: *desc_Tissue
        range: Tissue
      cell_type:
        description: *desc_CellType
        range: CellType
      cell_strain:
        description: *desc_CellStrain
        range: CellStrain
      cell_component:
        description: *desc_CellComponent
        range: CellComponent
  # ============================================================================

  # ============================================================================
  # dataset_metadata.json
  # ============================================================================
  Dataset:
    description: High-level description of a cryoET dataset.
    mixins:
      - DatestampedEntity
      - AuthoredEntity
      - FundedEntity
      - CrossReferencedEntity
      - ExperimentalMetadata

    attributes:
      dataset_identifier:
        exact_mappings:
        - cdp-common:dataset_identifier
      dataset_title:
        exact_mappings:
        - cdp-common:dataset_title
      dataset_description:
        exact_mappings:
        - cdp-common:dataset_description

  # ============================================================================

  # ============================================================================
  # TiltSeries metadata
  # ============================================================================
  Camera:
    description: &desc_camera The camera used to collect the tilt series.
    attributes:
      acquire_mode:
        exact_mappings:
          - cdp-common:tiltseries_camera_acquire_mode
      manufacturer:
        exact_mappings:
          - cdp-common:tiltseries_camera_manufacturer
      model:
        exact_mappings:
          - cdp-common:tiltseries_camera_model

  Microscope:
    description: &desc_microscope The microscope used to collect the tilt series.
    attributes:
      manufacturer:
        exact_mappings:
          - cdp-common:tiltseries_microscope_manufacturer
      model:
        exact_mappings:
          - cdp-common:tiltseries_microscope_model

  MicroscopeOpticalSetup:
    description: &desc_microscope_optical_setup The optical setup of the microscope used to collect the tilt series.
    attributes:
      energy_filter:
        exact_mappings:
          - cdp-common:tiltseries_microscope_energy_filter
      phase_plate:
        exact_mappings:
          - cdp-common:tiltseries_microscope_phase_plate
      image_corrector:
        exact_mappings:
          - cdp-common:tiltseries_microscope_image_corrector

  TiltRange:
    description: &desc_tilt_range The range of tilt angles in the tilt series.
    attributes:
      min:
        exact_mappings:
          - cdp-common:tiltseries_tilt_min
      max:
        exact_mappings:
          - cdp-common:tiltseries_tilt_max
  # ============================================================================

  # ============================================================================
  # tiltseries_metadata.json
  # ============================================================================
  TiltSeries:
    description: Metadata describing a tilt series.

    attributes:
      acceleration_voltage:
        exact_mappings:
          - cdp-common:tiltseries_acceleration_voltage
      aligned_tiltseries_binning:
        exact_mappings:
          - cdp-common:tiltseries_aligned_tiltseries_binning
      binning_from_frames:
        exact_mappings:
          - cdp-common:tiltseries_binning_from_frames
      camera:
        description: *desc_camera
        range: Camera
        required: true
      data_acquisition_software:
        exact_mappings:
          - cdp-common:tiltseries_data_acquisition_software
      frames_count:
        exact_mappings:
          - cdp-common:tiltseries_frames_count
      is_aligned:
        exact_mappings:
          - cdp-common:tiltseries_is_aligned
      microscope:
        description: *desc_microscope
        range: Microscope
        required: true
      microscope_additional_info:
        exact_mappings:
          - cdp-common:tiltseries_microscope_additional_info
      microscope_optical_setup:
        description: *desc_microscope_optical_setup
        range: MicroscopeOpticalSetup
        required: true
      related_empiar_entry:
        exact_mappings:
          - cdp-common:tiltseries_related_empiar_entry
      spherical_aberration_constant:
        exact_mappings:
          - cdp-common:tiltseries_spherical_aberration_constant
      tilt_alignment_software:
        exact_mappings:
          - cdp-common:tiltseries_tilt_alignment_software
      tilt_axis:
        exact_mappings:
          - cdp-common:tiltseries_tilt_axis
      tilt_range:
        description: *desc_tilt_range
        range: TiltRange
        required: true
      tilt_series_quality:
        exact_mappings:
          - cdp-common:tiltseries_tilt_series_quality
      tilt_step:
        exact_mappings:
          - cdp-common:tiltseries_tilt_step
      tilting_scheme:
        exact_mappings:
          - cdp-common:tiltseries_tilting_scheme
      total_flux:
        exact_mappings:
          - cdp-common:tiltseries_total_flux
      pixel_spacing:
        exact_mappings:
          - cdp-common:tiltseries_pixel_spacing
  # ============================================================================

  # ============================================================================
  # Tomogram metadata
  #
  # NOTE: Because TomogramSize and TomogramOffset have the same slot names, we 
  # must define them here because they will not be properly mapped from cdp-common.
  # If desired, we can modify schema.py to permit the use of the same slot name.
  # For now, this is the simplest solution.
  # ============================================================================
  TomogramSize:
    description: &desc_tomogram_size The size of a tomogram in voxels in each dimension.
    attributes:
      x:
        range: integer
        # TODO: uncomment after any_of is fixed https://github.com/linkml/linkml/issues/1521
        # any_of:
        #   - range: integer
        #   - range: IntegerFormattedString
        required: true
        description: Number of pixels in the 3D data fast axis
        unit: 
          descriptive_name: pixels
          symbol: px
      y:
        range: integer
        # TODO: uncomment after any_of is fixed https://github.com/linkml/linkml/issues/1521
        # any_of:
        #   - range: integer
        #   - range: IntegerFormattedString
        required: true
        description: Number of pixels in the 3D data medium axis
        unit:
          descriptive_name: pixels
          symbol: px
      z:
        range: integer
        # TODO: uncomment after any_of is fixed https://github.com/linkml/linkml/issues/1521
        # any_of:
        #   - range: integer
        #   - range: IntegerFormattedString
        required: true
        description: Number of pixels in the 3D data slow axis.  This is the image projection direction at zero stage tilt
        unit:
          descriptive_name: pixels
          symbol: px

  TomogramOffset:
    description: &desc_tomogram_offset The offset of a tomogram in voxels in each dimension relative to the canonical tomogram.
    attributes:
      x:
        range: integer
        # TODO: uncomment after any_of is fixed https://github.com/linkml/linkml/issues/1521
        # any_of:
        #   - range: integer
        #   - range: IntegerFormattedString
        required: true
        description: x offset data relative to the canonical tomogram in pixels
        unit:
          descriptive_name: pixels
          symbol: px
      y:
        range: integer
        # TODO: uncomment after any_of is fixed https://github.com/linkml/linkml/issues/1521
        # any_of:
        #   - range: integer
        #   - range: IntegerFormattedString
        required: true
        description: y offset data relative to the canonical tomogram in pixels
        unit:
          descriptive_name: pixels
          symbol: px
      z:
        range: integer
        # TODO: uncomment after any_of is fixed https://github.com/linkml/linkml/issues/1521
        # any_of:
        #   - range: integer
        #   - range: IntegerFormattedString
        required: true
        description: z offset data relative to the canonical tomogram in pixels
        unit:
          descriptive_name: pixels
          symbol: px

  # ============================================================================

  # ============================================================================
  # tomogram_metadata.json
  # ============================================================================
  Tomogram:
    description: Metadata describing a tomogram.
    mixins:
      - AuthoredEntity

    attributes:
      voxel_spacing:
        exact_mappings:
          - cdp-common:tomogram_voxel_spacing
      fiducial_alignment_status:
        exact_mappings:
          - cdp-common:tomogram_fiducial_alignment_status
      ctf_corrected:
        exact_mappings:
          - cdp-common:tomogram_ctf_corrected
      align_software:
        exact_mappings:
          - cdp-common:tomogram_align_software
      reconstruction_method:
        exact_mappings:
          - cdp-common:tomogram_reconstruction_method
      reconstruction_software:
        exact_mappings:
          - cdp-common:tomogram_reconstruction_software
      processing:
        exact_mappings:
          - cdp-common:tomogram_processing
      processing_software:
        exact_mappings:
          - cdp-common:tomogram_processing_software
      tomogram_version:
        exact_mappings:
          - cdp-common:tomogram_version
      affine_transformation_matrix:
          description: The flip or rotation transformation of this author submitted tomogram is indicated here
          range: Any
          array: 
            exact_number_dimensions: 2
            dimensions:
              - exact_cardinality: 4
              - exact_cardinality: 4
      size:
        description: *desc_tomogram_size
        range: TomogramSize
      offset:
        description: *desc_tomogram_offset
        range: TomogramOffset
        required: true
  # ============================================================================

  # ============================================================================
  # Annotation metadata
  # ============================================================================
  AnnotationConfidence:
    description: &desc_annotation_confidence Metadata describing the confidence of an annotation.
    attributes:
      precision:
        exact_mappings:
          - cdp-common:annotation_confidence_precision
      recall:
        exact_mappings:
          - cdp-common:annotation_confidence_recall
      ground_truth_used:
        exact_mappings:
          - cdp-common:annotation_ground_truth_used

  AnnotationObject:
    description: &desc_annotation_object Metadata describing the object being annotated.
    attributes:
      id:
        exact_mappings:
          - cdp-common:annotation_object_id
      name:
        exact_mappings:
          - cdp-common:annotation_object_name
      description:
        exact_mappings:
          - cdp-common:annotation_object_description
      state:
        exact_mappings:
          - cdp-common:annotation_object_state

  AnnotationSourceFile:
    description: &desc_annotation_source_file File and sourcing data for an annotation. Represents an entry in annotation.sources. 
    attributes:
      file_format:
        exact_mappings:
          - cdp-common:annotation_source_file_format
      glob_string:
        exact_mappings:
          - cdp-common:annotation_source_file_glob_string
      is_visualization_default:
        exact_mappings:
          - cdp-common:annotation_source_file_is_visualization_default

  AnnotationOrientedPointFile:
    is_a: AnnotationSourceFile
    aliases: 
    - OrientedPoint
    description: File and sourcing data for an oriented point annotation. Annotation that identifies points along with orientation in the volume.
    attributes:
      binning: 
        exact_mappings:
          - cdp-common:annotation_source_file_binning
      filter_value:
        exact_mappings:
          - cdp-common:annotation_source_file_filter_value
      order:
        exact_mappings:
          - cdp-common:annotation_source_file_order
  
  AnnotationInstanceSegmentationFile:
    is_a: AnnotationOrientedPointFile
    aliases: 
    - InstanceSegmentation
    description: File and sourcing data for an instance segmentation annotation. Annotation that identifies individual instances of object shapes.
    attributes: # no extended attributes

  AnnotationPointFile:
    is_a: AnnotationSourceFile
    aliases:
    - Point
    description: File and sourcing data for a point annotation. Annotation that identifies points in the volume.
    attributes:
      binning: 
        exact_mappings:
          - cdp-common:annotation_source_file_binning
      columns:
        exact_mappings:
          - cdp-common:annotation_source_file_columns
      delimiter:
        exact_mappings:
          - cdp-common:annotation_source_file_delimiter

  AnnotationSegmentationMaskFile:
    is_a: AnnotationSourceFile
    aliases: 
    - SegmentationMask
    description: File and sourcing data for a segmentation mask annotation. Annotation that identifies an object.
    attributes: # no extended attributes

  AnnotationSemanticSegmentationMaskFile:
    is_a: AnnotationSourceFile
    aliases: 
    - SemanticSegmentationMask
    description: File and sourcing data for a semantic segmentation mask annotation. Annotation that identifies classes of objects.
    attributes:
      mask_label:
        exact_mappings:
          - cdp-common:annotation_source_file_mask_label

  # ============================================================================

  # ============================================================================
  # annotation_metadata.json
  # ============================================================================
  Annotation:
    description: Metadata describing an annotation.
    mixins:
    - DatestampedEntity
    - AuthoredEntity

    attributes:
      annotation_method:
        exact_mappings:
          - cdp-common:annotation_method
      annotation_object:
        description: *desc_annotation_object
        range: AnnotationObject
        required: true
      annotation_publications:
        exact_mappings:
          - cdp-common:annotation_publication
      annotation_software:
        exact_mappings:
          - cdp-common:annotation_software
      confidence:
        description: *desc_annotation_confidence
        range: AnnotationConfidence
      files:
        description: *desc_annotation_source_file
        range: AnnotationSourceFile
        multivalued: true
        inlined_as_list: true
        list_elements_ordered: true
      ground_truth_status:
        exact_mappings:
          - cdp-common:annotation_ground_truth_status
      is_curator_recommended:
        exact_mappings:
          - cdp-common:annotation_is_curator_recommended
      method_type:
        exact_mappings:
          - cdp-common:annotation_method_type
      object_count:
        exact_mappings:
          - cdp-common:annotation_object_count
      version:
        exact_mappings:
          - cdp-common:annotation_version
      
  # ============================================================================
