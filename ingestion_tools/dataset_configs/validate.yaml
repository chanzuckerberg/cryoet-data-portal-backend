## NOTE: TEMPORARY FILE, WILL BE REMOVED BEFORE PR, NEEDS TO BE UPDATED

name: dataset_config
# TODO: change this later, placeholder
id: https://chanzuckerberg.github.io/cryoet-data-portal/ingestion_tools/dataset_configs/validate.yaml
description: |-
  This linkml file contains the dataset configuration (and validation) schema for the dataset ingestion tool.
  TODO: 
    - Do we need id, license, and version metadata fields here?
    - Why dataset: on the template.yaml, but on regular files, is datasets:? (template.yaml is outdated, update)
    - Is there a specific schema we should use? eg http://schema.org/ Or specific types? Might be excessive.
    - Make specific types / slots / enums for values, make types more strict. Figure out which classes / attributes are multi-valued.
    - Run linting on this file to ensure it is correct / follows best practices.
    - What is required at the root level? standardization config? 
    - Generate bad config files to test against? [YES]
    - Generate docs for this linkml file? [follow up on]
    - Read through https://linkml.io/linkml-model/latest/docs/SlotDefinition/
    - Date issue (needs to be quoted)
    - Need to build enums / restrain values
    - Write conditional requires? (e.g., mask_label only required if shape is SemanticSegmentationMask), confidence in annotations
    - Write up a validation doc. Exclusive validation? Augment Pydantic with super validation? 
    
  Files to remove before PR: test-validate.yaml, test.yaml, 10016-test.yaml
imports:
  - linkml:types
prefixes:
  linkml: https://w3id.org/linkml/
  schema: http://schema.org/

#========================
# Classes
#========================

classes:
  Container:
    tree_root: true
    attributes:
      datasets:
        range: Datasets
        multivalued: true
        required: true
      annotations:
        range: Annotations
        multivalued: true
        required: true
      runs:
        range: Runs
        required: true
      tiltseries:
        range: Tiltseries
        required: true
      tomograms:
        range: Tomograms
        required: true
      standardization_config:
        range: StandardizationConfig
        required: true
      # not sure if these should behere, based on 10016.yaml
      dataset_keyphotos:
        range: DatasetKeyPhotos
        required: false
      key_images:
        range: KeyImages
        required: false
      rawtilts:
        range: Rawtilts
        required: false
      voxel_spacings:
        range: VoxelSpacings
        required: false
      

  Datasets:
    attributes:
      metadata:
        range: DatasetMetadata
        required: true
      # not in template
      sources:
        range: DatasetSources
        multivalued: true
        required: false

  DatasetMetadata:
    attributes:
      authors:
        range: Authors
        multivalued: true
        required: true
      cell_component:
        range: CellComponent
        required: false
      cell_strain:
        range: CellStrain
        required: false
      cell_type:
        range: CellType
        required: false
      cross_references:
        range: CrossReferences
        required: false
      dataset_identifier:
        range: integer
        required: true
      dataset_description:
        range: string
        required: true
      dataset_title:
        range: string
        required: true
      dates:
        range: Dates
        required: true
      grid_preparation:
        range: string
        required: false
      key_photos:
        range: KeyPhotos
        # TODO: should be multivalued? more in general, what should be multivalued?
        multivalued: true
        required: false
      organism:
        range: Organism
        required: true
      sample_preparation:
        range: string
        required: false
      sample_type:
        range: string
        required: true
      tissue:
        range: Tissue
        required: false


  Annotations:
    attributes:
      metadata:
        range: AnnotationMetadata

  AnnotationMetadata:
    attributes:
      annotation_object:
        range: AnnotationObject
        required: true
      annotation_method:
        range: string
        required: true
      annotation_publications:
        range: string
        required: false
      annotation_software:
        range: string
        required: false
      authors:
        range: Authors
        multivalued: true
        required: false
      confidence:
        range: Confidence
        required: false
      dates:
        range: Dates
        required: true
      ground_truth_status:
        range: boolean
        required: true
      is_curator_recommended:
        range: boolean
        required: false
      method_type:
        range: string
        required: true
      sources:
        range: AnnotationSources
        multivalued: true
        required: false
      version:
        range: string
        required: false

  AnnotationObject: 
    attributes:
      id:
        range: string
        required: true
      name:
        range: string
        required: true
      description:
        range: string
        required: false
      state:
        range: string
        required: false

  AnnotationSources:
    attributes:
      columns:
        range: string
        required: true
      file_format:
        range: string
        required: true
      glob_string:
        range: string
        required: true
      shape:
        range: string
        required: true
      is_visualization_default:
        range: boolean
        required: false
      delimiter:
        range: string
        required: false
      mask_label:
        range: integer
        required: false

  Authors:
    attributes:
      name:
        range: string
        required: true
      ORCID:
        range: string
        required: false
      primary_author_status:
        range: boolean
        # TODO: possibly make this required = true and verify that there is only one primary annotator? something similar for corresponding_author_status?
        required: false
      corresponding_author_status:
        range: boolean
        required: false

  CellComponent:
    attributes:
      id:
        range: string
        identifier: true
        required: false
      name:
        range: string
        required: false

  CellStrain:
    attributes:
      # TODO: Can't have null as a value if range is string (likely if range is even just set), see:
      # TODO: Want to make required: false and range: string, but might be bugged, see:
      # https://github.com/orgs/linkml/discussions/1975
      # https://github.com/linkml/linkml/issues/2155
      id:
        range: string
        required: false
      name:
        range: string
        required: false

  CellType:
    attributes:
      id:
        range: string
        identifier: true
        required: false
      name:
        range: string
        required: false

  Confidence:
    attributes:
      precision: 
        range: float
        required: true
      recall:
        range: float
        required: true
      ground_truth_used:
        range: boolean
        required: false

  CrossReferences:
    attributes:
      dataset_publications:
        range: string
        required: false
      related_database_entries:
        range: string
        required: false

  # TODO: are these all required?
  Dates:
    attributes:
      deposition_date:
        range: date
        required: true
      last_modified_date:
        range: date
        required: true
      release_date:
        range: date
        required: true

  Funding:
    attributes:
      funding_agency_name:
        range: string
        required: false
      grant_id:
        range: string
        required: false

  KeyPhotos:
    attributes:
      snapshot:
        range: string
        required: false
      thumbnail:
        range: string
        required: false

  Organism:
    attributes:
      name:
        range: string
        required: true
      taxonomy_id:
        range: integer
        required: true

  Tissue:
    attributes:
      id:
        range: string
        identifier: true
        required: false
      name:
        range: string
        required: false

  # Especially not sure about sources stuff
  DatasetSources:
    attributes:
      literal:
        range: Literal
        required: false
      source_glob:
        range: SourceGlob
        required: false
      source_multi_glob:
        range: SourceMultiGlob
        required: false

  Literal:
    attributes:
      value:
        range: string
        multivalued: true
        required: true

  SourceGlob:
    attributes:
      list_glob:
        range: string
        required: true
      match_regex:
        range: string
        required: true
      name_regex:
        range: string
        required: false

  SourceMultiGlob:
    attributes:
      list_globs:
        range: string
        required: true
      match_regex:
        range: string
        required: true
      name_regex:
        range: string
        required: false

#========================
# Slots (attributes)
#========================

slots:

#========================
# Types
#========================

types:
  GoID: 
    base: string
    # TODO: improve this description
    description: A unique identifier, prefixed by "GO:" and followed by 7 digits OR null.
    pattern: '^GO:[0-9]{7}$|^null$'

#========================
# Enums
#========================

enums: