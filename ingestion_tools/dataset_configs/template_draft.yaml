# TODO: character-limit strings?
# TODO: null checks might be weird (how linkml interprets null and nested nulls and whatnot)
# TODO: nullable (REQUIRED) values? - these should be handled as if they were not there by linkML - so putting a null in a config file for a REQUIRED will fail
# TODO: QUESTION: given that a field is required, but all of its attributes are optional, should it be implied that there exist at least one attribute?
# TODO: DISCUSS: some types may be wrong (type conflicts)
# TODO: DISCUSS: how to deal with curly-braced values? e.g., {ts-tilt_alignment_software}
# TODO: DISCUSS: values that are in template.yaml but not found in any of the files, primarily in standardization_config
# TODO: varying nature of sources means that there are inherently different source structures?
annotations: OPTIONAL
- metadata: REQUIRED
    annotation_confidence: REQUIRED [?]
      ground_truth_used: OPTIONAL, BOOLEAN
      precision: REQUIRED IF ground_truth_used, FLOAT ([0, 1])
      recall: REQUIRED IF ground_truth_used, FLOAT ([0, 1])
    annotation_method: REQUIRED, STRING
    annotation_object: REQUIRED
      description: OPTIONAL, STRING
      id: REQUIRED, STRING (^GO[0-9]{7}$)
      name: REQUIRED, STRING
      state: OPTIONAL, STRING
    annotation_publications: OPTIONAL, STRING # TODO: string list?
    annotation_software: OPTIONAL, STRING, recommended
    authors: OPTIONAL, recommended [?, children are also ?]
    - ORCID: OPTIONAL, STRING (^0000-[0-9]{4}-[0-9]{4}-[0-9]{4}$)
      corresponding_author_status: OPTIONAL, BOOLEAN # TODO: constraint check to ensure max. one true value
      name: OPTIONAL, STRING
      primary_annotator_status: OPTIONAL, BOOLEAN # TODO: see corresp. author status
    confidence: # TODO: annotation_confidence conflict? mostly annotation_confidence, but they contain largely null values
      ground_truth_used:
      precision:
      recall:
    dates: REQUIRED [?] # TODO: what should date format be? XXXX-XX-XX?
      deposition_date: REQUIRED, STRING, DATE # TODO: require this to be before last_modified_date and release_date?
      last_modified_date: REQUIRED, STRING, DATE
      release_date: REQUIRED, STRING, DATE
    ground_truth_status: REQUIRED, BOOLEAN
    is_curator_recommended: OPTIONAL, BOOLEAN # TODO: Default value of false?
    method_type: REQUIRED, ENUM (manual, hybrid, automated)
    version: REQUIRED, STRING [?] # TODO: regex?
  sources: REQUIRED [?] # TODO: existence constraints for children
  - binning: OPTIONAL, INTEGER
    columns: OPTIONAL, STRING # TODO: multivalued? regex? enum?
    delimiter: OPTIONAL, STRING # TODO: regex?
    file_format: OPTIONAL, STRING # TODO: ENUM?
    filter_value: OPTIONAL, STRING # TODO: should this be a string, not in template.yaml
    glob_string: OPTIONAL, STRING # TODO: regex?
    is_visualization_default: OPTIONAL, BOOLEAN
    mask_label: OPTIONAL, INTEGER > 0 # REQUIRED for SemanticSegmentationMask?
    order: OPTIONAL, STRING # TODO: multivalued? regex? enum?, not in template.yaml
    shape: OPTIONAL, ENUM (InstanceSegmentation, OrientedPoint, Point, SemanticSegmentationMask) # what are ENUM values?
dataset_keyphotos: REQUIRED IF datasets EXISTS, ELSE NULL [?]
- sources: REQUIRED
  - literal: REQUIRED
      value: REQUIRED
        snapshot: REQUIRED, STRING # regex for allowed file formats?
        thumbnail: REQUIRED, STRING # regex for allowed file formats?
datasets: REQUIRED [?]
- metadata: REQUIRED
    authors: OPTIONAL, recommended [?] (See annotations authors?)
    - ORCID:
      corresponding_author_status:
      name:
      primary_author_status:
    cell_component: EXISTS IF (...) DON'T EXIST [?]
      id: REQUIRED, STRING (^GO[0-9]{7})
      name: OPTIONAL
    cell_strain: EXISTS IF (...) DON'T EXIST [?]
      id: REQUIRED, STRING # TODO: (seems like it can be url, id, just regular string too?)
      name: OPTIONAL
    cell_type: EXISTS IF (...) DON'T EXIST [?]
      id: REQUIRED, STRING # TODO: regex? | see cell_type id
      name: OPTIONAL
    cross_references: OPTIONAL
      dataset_publications: OPTIONAL, STRING # regex?
      related_database_entries: OPTIONAL, STRING # string list?
    dataset_description: REQUIRED, STRING
    dataset_identifier: REQUIRED, INTEGER # TODO: regex?
    dataset_title: REQUIRED, STRING
    dates: SEE annotations dates
      deposition_date:
      last_modified_date:
      release_date:
    funding: OPTIONAL, recommended
    - funding_agency_name: OPTIONAL, STRING, recommended
      grant_id: OPTIONAL, STRING, recommended
    grid_preparation: OPTIONAL, STRING, recommended
    organism: REQUIRED
      id: REQUIRED, INTEGER # same as taxonomy_id? or different?
      name: REQUIRED, STRING
      taxonomy_id: REQUIRED, INTEGER
    sample_preparation: OPTIONAL, STRING, recommended
    sample_type: REQUIRED, string
    tissue: OPTIONAL # manually added, in template.yaml but none of the files
      id: OPTIONAL
      name: OPTIONAL
  sources: REQUIRED [?], not sure about whole thing
  - literal: REQUIRED
      value: REQUIRED
      - REQUIRED, STRING, INTEGER?
    source_glob: OPTIONAL [?] # TODO: what is this?
      list_glob: REQUIRED, STRING [?]
      match_regex: OPTIONAL, STRING [?]
      name_regex: OPTIONAL, STRING [?]
frames: REQUIRED IF datasets EXISTS, ELSE NULL [?]
- sources: REQUIRED
  - source_glob: REQUIRED
      list_glob: REQUIRED, STRING # TODO: why is it called list_glob?
gains: SEE frames
- sources:
  - source_glob:
      list_glob:
key_images: SEE frames
- sources:
  - literal:
      value:
      - REQUIRED, STRING
    source_glob:
      list_glob:
rawtilts: SEE frames
- sources:
  - source_multi_glob:
      list_globs:
      - '{run_name}/rawdata/*.mdoc'
      - '{run_name}/file_*/*.rawtlt'
      - '{run_name}/{mapped_frame_name}/*.rawtlt'
runs: SEE frames # TODO: has match_regex (Should this be in all sources -> source_glob?)
- sources:
  - source_glob:
      list_glob: '*'
      match_regex: (dga2017-07-08-1|dga2017-07-08-2|dga2017-07-08-3|dga2017-07-08-4|dga2017-07-08-5|dga2017-07-08-6|dga2017-07-08-7|dga2017-07-08-8|dga2017-07-08-9|dga2017-07-08-10|dga2017-07-08-11|dga2017-07-08-13|dga2017-07-08-14|dga2017-07-08-15|dga2017-07-08-16|dga2017-07-08-17|dga2017-07-08-18|dga2017-07-08-19|dga2017-07-08-20|dga2017-07-08-21|dga2017-07-08-22|dga2017-07-08-23|dga2017-07-08-24|dga2017-07-08-25|dga2017-07-08-26|dga2017-07-08-27|dga2017-07-08-28|dga2017-07-08-29|dga2017-07-08-30|dga2017-07-08-31|dga2017-07-08-32|dga2017-07-08-33|dga2017-07-08-34|dga2017-07-08-35|dga2017-07-08-36|dga2017-07-08-37|dga2017-07-08-38|dga2017-07-08-39|dga2017-07-08-40|dga2017-07-08-41|dga2017-07-08-42|dga2017-07-08-43|dga2017-07-08-44|dga2017-07-08-45|dga2017-07-08-46|dga2017-07-08-47|dga2017-07-08-48|dga2017-07-08-49|dga2017-07-08-50|dga2017-07-08-51|dga2017-07-08-52|dga2017-07-08-53|dga2017-07-08-54|dga2017-07-08-55|dga2017-07-08-56|dga2017-07-08-57|dga2017-07-08-58|dga2017-07-08-59|dga2017-07-08-60|dga2017-07-08-61|dga2017-07-08-62|dga2017-07-08-63|dga2017-07-08-64|dga2017-07-08-65|dga2017-07-08-66|dga2017-07-08-67|dga2017-07-08-68|dga2017-07-08-69|dga2017-07-08-70|dga2017-07-08-71|dga2017-07-08-72|dga2017-07-08-73|dga2017-07-08-74|dga2017-07-08-75|dga2017-07-08-76|dga2017-07-08-77|dga2017-07-08-78|dga2017-07-08-79|dga2017-07-08-80|dga2017-07-08-81|dga2017-07-08-82|dga2017-07-08-83|dga2017-07-08-84|dga2017-07-08-85|dga2017-07-08-86|dga2017-07-08-87|dga2017-07-08-88|dga2017-07-08-89|dga2017-07-08-90|dga2017-07-08-91|dga2017-07-08-92|dga2017-07-08-93|dga2017-07-08-94|dga2017-07-08-95|dga2017-07-08-96|dga2017-07-08-97|dga2017-07-08-98|dga2017-07-08-99|dga2017-07-08-100|dga2017-07-08-101|dga2017-07-08-102|dga2017-07-08-103|dga2017-07-08-104|dga2017-07-08-105)$
      name_regex: (.*)
standardization_config: REQUIRED # reference template.yaml, some of the fields in there never show up
  deposition_id: REQUIRED, INTEGER
  run_data_map_file: REQUIRED IF datasets [?], STRING # regex for file format (ex. run_data_map/10084.csv)
  run_to_frame_map_csv: REQUIRED IF frames [?], STRING # regex?
  run_to_tomo_map_csv: REQUIRED IF tomograms [?], STRING # regex?
  run_to_ts_map_csv: REQUIRED IF tiltseries [?], STRING # regex?
  source_prefix: REQUIRED, STRING
tiltseries: REQUIRED IF datasets EXISTS, ELSE NULL [?]
- metadata: REQUIRED [?]
    acceleration_voltage: REQUIRED, INTEGER
    aligned_tiltseries_binning: REQUIRED, INTEGER
    alignment_binning_factor: REQUIRED if is_aligned, FLOAT
    binning_from_frames: REQUIRED, INTEGER
    camera: REQUIRED
      acquire_mode: REQUIRED, STRING, ENUM [?]
      manufacturer: REQUIRED, STRING
      model: REQUIRED, STRING
    data_acquisition_software: REQUIRED, STRING
    is_aligned: REQUIRED, BOOLEAN
    microscope: RQUIRED
      additional_scope_info: OPTIONAL, STRING
      manufacturer: REQUIRED, STRING
      model: REQUIRED, STRING
    microscope_optical_setup: REQUIRED
      energy_filter: REQUIRED, STRING
      image_corrector: REQUIRED, STRING
      phase_plate: REQUIRED, BOOLEAN
    pixel_spacing: REQUIRED, FLOAT
    related_empiar_entry: OPTIONAL
    spherical_aberration_constant: REQUIRED, FLOAT
    tilt_alignment_software: OPTIONAL, STRING [?]
    tilt_axis: OPTIONAL, FLOAT
    tilt_range: REQUIRED
      max: REQUIRED, FLOAT
      min: REQUIRED, FLOAT
    tilt_series_path: OPTIONAL, STRING [?]
    tilt_series_quality: REQUIRED, INTEGER / ENUM [?]
    tilt_step: OPTIONAL, FLOAT
    tilting_scheme: OPTIONAL, STRING, recommended
    total_flux: REQUIRED
  sources: REQUIRED [?]
  - parent_filters: REQUIRED [?]
      exclude: OPTIONAL
        run: REQUIRED
        - ^ay08102021_grid_3_lamella3_pos12$
        - ^ay18112021_grid2_lamella1_position2$
        - ^ay18112021_grid2_lamella4_position11$
        - ^ay18112021_grid2_lamella4_position13
        - ^ay18112021_grid2_lamella5_position16$
        - ^ay18112021_gridX_lamella1_pos5$
        - ^ay18112021_gridX_lamella8_pos6$
      include: OPTIONAL
        run: REQUIRED
        - ^ay08102021_grid_3_lamella3_pos12$
        - ^ay18112021_grid2_lamella1_position2$
        - ^ay18112021_grid2_lamella4_position11$
        - ^ay18112021_grid2_lamella4_position13$
        - ^ay18112021_grid2_lamella5_position16$
        - ^ay18112021_gridX_lamella1_pos5$
        - ^ay18112021_gridX_lamella8_pos6$
    source_glob: OPTIONAL
      list_glob: OPTIONAL, STRING
      match_regex: OPTIONAL, STRING
      name_regex: OPTIONAL, STRING
tomograms: REQUIRED IF datasets EXISTS, ELSE NULL [?]
- metadata: REQUIRED
    affine_transformation_matrix: REQUIRED [?] [4X4 matrix?]
    - - REQUIRED, FLOAT # e.g., 1
      - 0
      - 0
      - 0
    - - 0
      - 1
      - 0
      - 0
    - - 0
      - 0
      - 1
      - 0
    - - 0
      - 0
      - 0
      - 1
    align_softwares: OPTIONAL # not in template.yaml
    - REQUIRED, STRING
    authors: REQUIRED [?] see annotations authors
    - ORCID:
      corresponding_author_status:
      name:
      primary_author_status:
    ctf_corrected: REQUIRED, BOOLEAN
    fiducial_alignment_status: REQUIRED, BOOLEAN # has type conflicts
    offset: REQUIRED
      x: REQUIRED, FLOAT [?]
      y: REQUIRED, FLOAT [?]
      z: REQUIRED, FLOAT [?]
    processing: REQUIRED, ENUM (denoised, filtered, raw)
    processing_software: OPTIONAL [?] # not in template.yaml
    reconstruction_method: REQUIRED, STRING
    reconstruction_software: REQUIRED, STRING
    tomogram_version: REQUIRED, INTEGER # or string regex? in files, are basically all 1
    voxel_spacing: REQUIRED, FLOAT
  sources: REQUIRED
  - source_glob: REQUIRED [?]
      list_glob: REQUIRED, STRING [?]
      match_regex: REQUIRED, STRING [?]
voxel_spacings: REQUIRED IF datasets EXISTS, ELSE NULL [?]
- sources: REQUIRED
  - destination_glob: REQUIRED [?]
      list_glob: REQUIRED, STRING [?]
      match_regex: REQUIRED, STRING [?]
      name_regex: REQUIRED, STRING [?]
    literal: REQUIRED [?]
      value: REQUIRED
      - REQUIRED, FLOAT
